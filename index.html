<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  </head>
  <body style="margin: 0px; overflow: hidden;">
    <a-scene 
      embedded 
      arjs="sourceType: webcam; debugUIEnabled: true; detectionMode: mono_and_matrix; matrixCodeType: 3x3; trackingMethod: best; sourceWidth: 1280; sourceHeight: 960; displayWidth: 1280; displayHeight: 960; cameraParametersUrl: https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/data/camera_para.dat"
      renderer="logarithmicDepthBuffer: true; precision: medium; antialias: true; alpha: true"
      vr-mode-ui="enabled: false"
      gesture-detector
    >
      <a-assets>
        <img id="my-image" src="https://i.imgur.com/say4jZm.jpg" crossorigin="anonymous">
      </a-assets>
      
      <a-light type="ambient" intensity="0.5"></a-light>
      
      <a-marker 
        preset="hiro"
        id="markerA"
        registerevents
        smooth="true"
        smoothCount="5"
        smoothTolerance="0.01"
        smoothThreshold="2"
        raycaster="objects: .clickable"
        emitevents="true"
        cursor="fuse: false; rayOrigin: mouse"
      >
        <a-box
          position="0 0.5 0"
          depth="0.1"
          height="0.1"
          width="0.1"
          color="red"
          material="opacity: 0.8"
        ></a-box>
        
        <a-image
          src="#my-image"
          position="0 0 0"
          rotation="-90 0 0"
          width="2"
          height="2"
          material="shader: flat; transparent: false; side: double"
          geometry="primitive: plane"
          visible="true"
        ></a-image>
      </a-marker>
      
      <a-entity camera look-controls-enabled="false" wasd-controls-enabled="false" arjs-look-controls="smoothingFactor: 0.1"></a-entity>
    </a-scene>

    <script>
      // Wait for scene to be ready
      document.addEventListener('DOMContentLoaded', function() {
        const scene = document.querySelector('a-scene');
        const marker = document.querySelector('#markerA');
        
        // Add event listeners for marker found/lost
        marker.addEventListener('markerFound', function() {
          console.log('Marker found!');
          // Force visibility
          const image = marker.querySelector('a-image');
          if (image) {
            image.setAttribute('visible', true);
          }
        });
        
        marker.addEventListener('markerLost', function() {
          console.log('Marker lost!');
        });
        
        // Initialize after a brief delay to ensure camera is ready
        setTimeout(() => {
          console.log('AR.js initialized');
          // Additional initialization if needed
        }, 2000);
      });
    </script>
  </body>
</html>
